\hypertarget{_r_b_utils_8h_source}{}\doxysection{RBUtils.\+h}
\label{_r_b_utils_8h_source}\index{src/libs/loco/include/loco/robot/RBUtils.h@{src/libs/loco/include/loco/robot/RBUtils.h}}
\mbox{\hyperlink{_r_b_utils_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{geoms_8h}{crl-\/basic/utils/geoms.h}}>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{math_utils_8h}{crl-\/basic/utils/mathUtils.h}}>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecrl_1_1loco}{crl::loco}}\ \{}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{enum}\ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2}{RB\_KEYWORDS}}\ \{}
\DoxyCodeLine{00009\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a5bdba8c77e9f78b020f5db5a133831b5}{RB\_NOT\_IMPORTANT}}\ =\ -\/1,}
\DoxyCodeLine{00010\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2af5ef98120b5bfb16cde82d0ad8d6fd4c}{RB\_RB}},}
\DoxyCodeLine{00011\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a0c2b9c640968863cf7a56fb447189c35}{RB\_END\_RB}},}
\DoxyCodeLine{00012\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a379a8d2dc308602edce039014856963a}{RB\_NAME}},}
\DoxyCodeLine{00013\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a5416ed9741c3bdcc1837a538c35f2cad}{RB\_MASS}},}
\DoxyCodeLine{00014\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a1f0f6e034468fc6149c62f6383773992}{RB\_MOI}},}
\DoxyCodeLine{00015\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2ac998c7152fb155cf37fd5edb441f3b66}{RB\_IS\_FROZEN}},}
\DoxyCodeLine{00016\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a50404dae63225ae6a0667a24bbc4d1ce}{RB\_COLLISION\_SPHERE}},}
\DoxyCodeLine{00017\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a81106345293901741e2529bed0403321}{RB\_COLLISION\_BOX}},}
\DoxyCodeLine{00018\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2afec3a018e4d0d1caf02fbdb836f86a0e}{RB\_COLLISION\_CYLINDER}},}
\DoxyCodeLine{00019\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2abd00d552f7054396b9d6151b5424a895}{RB\_COLLISION\_CAPSULE}},}
\DoxyCodeLine{00020\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2aef58e793a602a747c1b595d0f008554f}{RB\_COLLISION\_PLANE}},}
\DoxyCodeLine{00021\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a6191b26183c0c94f95fd8476e6ed7786}{RB\_MESH\_NAME}},}
\DoxyCodeLine{00022\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a35b20d5052d54a8ded796577e5219012}{RB\_MESH\_COLOR}},}
\DoxyCodeLine{00023\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2afcb1ae9c8b67d020676131ce6c25e2a4}{RB\_MESH\_TRANSFORMATION}},}
\DoxyCodeLine{00024\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2aece2a684fb8257fad488fd8893432a51}{RB\_MESH\_SCALE}},}
\DoxyCodeLine{00025\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a9b45e6966fb39739b52399ce9227afef}{RB\_MESH\_DESCRIPTION}},}
\DoxyCodeLine{00026\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a5155cf682f3821f5947e4de500c043f4}{RB\_MATCAP\_TEXTURE}},}
\DoxyCodeLine{00027\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a00d2c368a9a0368887dc8371445a6441}{RB\_CHILD}},}
\DoxyCodeLine{00028\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a8d6ad7c2a7c6048ab5bdfe4ced015bf0}{RB\_PARENT}},}
\DoxyCodeLine{00029\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a804a8595007fda68b415853cae4eb9b8}{RB\_PPOS}},}
\DoxyCodeLine{00030\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a94218565e71148e463adb2d6f6d5edcb}{RB\_CPOS}},}
\DoxyCodeLine{00031\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a579c90f002df462c95622be5d9c80264}{RB\_END\_EFFECTOR}},}
\DoxyCodeLine{00032\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2ab0906ae968d53a649356135eee16f33b}{RB\_JOINT}},}
\DoxyCodeLine{00033\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2ae39d89898787a03d76c2b62ebe77bf10}{RB\_JOINT\_LIMITS}},}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a0c1ed62a033bc25cf3fa0706a54ed761}{RB\_JOINT\_MAX\_SPEED}},}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a627ff68573f739fb20389e782027fe76}{RB\_JOINT\_MAX\_TORQUE}},}
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a205cd679f91139d04c58f6c1cd60521d}{RB\_JOINT\_AXIS}},}
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a33707a6cb390946868172a92a6875e38}{RB\_DEFAULT\_ANGLE}},}
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a292647898de65c06fc047d25bf3a5ec0}{RB\_JOINT\_MOTOR\_KP}},}
\DoxyCodeLine{00039\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2af14ae592d6de36913c55bb39679234b1}{RB\_JOINT\_MOTOR\_KD}},}
\DoxyCodeLine{00040\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a0115e561ec860f82cbab5108a93f26d5}{RB\_JOINT\_END}},}
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a05acbb6e18666601a24335396fac1698}{RB\_FRICTION\_COEFF}},}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a23b3a5dac28d3f6cf0aea159fda2b4c2a5d0d7703ce99ccbd5079495b0547175d}{RB\_REST\_COEFF}}}
\DoxyCodeLine{00043\ \};}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00048\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacecrl_1_1loco_a41598fc015109e3f7c04869de3e1f2ae}{getRRBLineType}}(\textcolor{keywordtype}{char}\ *\&buffer);}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00053\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{namespacecrl_1_1loco_ad18f65ee5e669514643f066382b13998}{getRRBString}}(\textcolor{keywordtype}{int}\ token);}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classcrl_1_1loco_1_1_r_b_globals}{RBGlobals}}\ \{}
\DoxyCodeLine{00056\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ gravitational\ acceleration}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcrl_1_1loco_1_1_r_b_globals_a4b6328770a8fd570652097dd9ba96526}{g}};}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ this\ is\ the\ direction\ of\ the\ up-\/vector}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ \mbox{\hyperlink{classcrl_1_1loco_1_1_r_b_globals_a5be1f31d51f0599f2bb381fba0830e03}{worldUp}};}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{comment}{//\ and\ the\ ground\ plane}}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classcrl_1_1_plane}{Plane}}\ \mbox{\hyperlink{classcrl_1_1loco_1_1_r_b_globals_a2ce7721e4e3fcd88eab9f2bd2b40800d}{groundPlane}};}
\DoxyCodeLine{00063\ \};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00081\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacecrl_1_1loco_a9a4c577e1240617907e57beca0d02271}{decomposeRotation}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&PqC,\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&Pq,\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&qC,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ \&v)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//\ we\ need\ to\ compute\ v\ in\ P's\ coordinates}}
\DoxyCodeLine{00083\ \ \ \ \ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ vP\ =\ PqC\ *\ v;}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ compute\ the\ rotation\ that\ alligns\ the\ vector\ v\ in\ the\ two\ coordinate}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ frames\ (P\ and\ T\ -\/\ remember\ that\ v\ has\ the\ same\ coordinates\ in\ C\ and\ in\ T)}}
\DoxyCodeLine{00086\ \ \ \ \ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ rotAxis\ =\ vP.\mbox{\hyperlink{classcrl_1_1_v3_d_a5dee29fe290a5b868fe0f46a2af2775c}{cross}}(v);}
\DoxyCodeLine{00087\ \ \ \ \ rotAxis.normalize();}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{double}\ rotAngle\ =\ -\/\mbox{\hyperlink{namespacecrl_a05ed2e0fa461f37617975d11563f3687}{safeACOS}}(vP.dot(v));}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ Pq\ =\ \mbox{\hyperlink{namespacecrl_a97d2ee8bd0dcfe6cf8d3cbfb9e40ad92}{getRotationQuaternion}}(rotAngle,\ rotAxis);}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{comment}{//\ now\ qB\ =\ qAinv\ *\ PqC}}
\DoxyCodeLine{00092\ \ \ \ \ qC\ =\ Pq.inverse()\ *\ PqC;}
\DoxyCodeLine{00093\ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00098\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \mbox{\hyperlink{namespacecrl_1_1loco_a9a4c577e1240617907e57beca0d02271}{decomposeRotation}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&PqC,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ \&v)\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ Pq\ =\ Quaternion::Identity(),\ qC\ =\ Quaternion::Identity();}
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a9a4c577e1240617907e57beca0d02271}{decomposeRotation}}(PqC,\ Pq,\ qC,\ v);}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{return}\ qC;}
\DoxyCodeLine{00102\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00108\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \mbox{\hyperlink{namespacecrl_1_1loco_a3b91c69106ee1597c71a64fc9263c72d}{computeHeading}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&q,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ \&upAxis)\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacecrl_1_1loco_a9a4c577e1240617907e57beca0d02271}{decomposeRotation}}(q.inverse(),\ upAxis).inverse();}
\DoxyCodeLine{00110\ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00115\ \textcolor{comment}{/*inline\ double\ getHeadingAngle(const\ Quaternion\&\ q,\ const\ V3D\&\ upAxis\ =\ V3D(0,\ 1,\ 0))\ \{}}
\DoxyCodeLine{00116\ \textcolor{comment}{\ \ \ \ //\ same\ for\ heading\ angles}}
\DoxyCodeLine{00117\ \textcolor{comment}{\ \ \ \ return\ getRotationAngle(computeHeading(q,\ upAxis),\ upAxis);}}
\DoxyCodeLine{00118\ \textcolor{comment}{\}*/}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00123\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespacecrl_1_1loco_a91c1c0e771d2f13dad7b6dc6c878ba97}{getHeadingAngle}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&q)\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ same\ for\ heading\ angles}}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keywordtype}{double}\ pitch\ =\ 0,\ roll\ =\ 0,\ yaw\ =\ 0;}
\DoxyCodeLine{00126\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_aa72b2b70e13f2b1a9c152033e638beb6}{computeEulerAnglesFromQuaternion}}(q,\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}(1,\ 0,\ 0),\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}(0,\ 0,\ 1),\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}(0,\ 1,\ 0),\ roll,\ pitch,\ yaw);}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{return}\ yaw;}
\DoxyCodeLine{00128\ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00134\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacecrl_1_1loco_a13d1c9e6c8499e7103abef73f02854dc}{computeRotationAngleFromQuaternion}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&q,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ \&a,\ \textcolor{keywordtype}{double}\ \&alpha)\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{comment}{//\ \ alpha\ =\ getRotationAngle(decomposeRotation(q,\ a),\ a);}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ v1,\ v2;}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{double}\ tmp1,\ tmp2;}
\DoxyCodeLine{00139\ \ \ \ \ \mbox{\hyperlink{namespacecrl_ad1ffb7a0e6fb2c2103cfd31992518f84}{getVectorsOrthogonalTo}}(a,\ v1,\ v2);}
\DoxyCodeLine{00140\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_aa72b2b70e13f2b1a9c152033e638beb6}{computeEulerAnglesFromQuaternion}}(q,\ a,\ v1,\ v2,\ alpha,\ tmp1,\ tmp2);}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00147\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacecrl_1_1loco_aa72b2b70e13f2b1a9c152033e638beb6}{computeEulerAnglesFromQuaternion}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&q,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ \&a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ \&b,\ \textcolor{keywordtype}{double}\ \&alpha,\ \textcolor{keywordtype}{double}\ \&beta)\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ we\ assume\ the\ quaternion\ corresponds\ to\ a\ rotation\ about\ the\ two\ axes}}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//\ only...\ therefore\ the\ axis\ a\ gets\ rotated\ about\ b\ by\ angle\ beta...}}
\DoxyCodeLine{00150\ \ \ \ \ assert(\mbox{\hyperlink{math_defs_8h_a0a69594b2ea1ac8262ab37a48fe774ff}{IS\_ZERO}}(a.dot(b)));}
\DoxyCodeLine{00151\ \ \ \ \ assert(\mbox{\hyperlink{math_defs_8h_a0a69594b2ea1ac8262ab37a48fe774ff}{IS\_ZERO}}(a.norm()\ -\/\ 1)\ \&\&\ \mbox{\hyperlink{math_defs_8h_a0a69594b2ea1ac8262ab37a48fe774ff}{IS\_ZERO}}(b.norm()\ -\/\ 1));}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ qA\ =\ Quaternion::Identity(),\ qB\ =\ Quaternion::Identity();}
\DoxyCodeLine{00154\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a9a4c577e1240617907e57beca0d02271}{decomposeRotation}}(q,\ qB,\ qA,\ a);}
\DoxyCodeLine{00155\ \ \ \ \ alpha\ =\ \mbox{\hyperlink{namespacecrl_a5db0b1362dd412558a35ba80d255997e}{getRotationAngle}}(qA,\ a);}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_a13d1c9e6c8499e7103abef73f02854dc}{computeRotationAngleFromQuaternion}}(qB,\ b,\ beta);}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{comment}{//\ Quaternion\ residual\ =\ (Quaternion::getRotationQuaternion(beta,\ b)\ *}}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{comment}{//\ Quaternion::getRotationQuaternion(alpha,\ a)\ *\ q.getComplexConjugate());}}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ Logger::printStatic("{}residual:\ \%lf\ (\%lf\ \%lf\ \%lf\ \%lf)\ -\/-\/>\ \%lf\ \%lf\(\backslash\)n"{},}}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{comment}{//\ residual.v.length(),\ residual.s,\ residual.v.x,\ residual.v.y,}}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{//\ residual.v.z,\ alpha,\ beta);\ \ assert(}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ IS\_ZERO((Quaternion::getRotationQuaternion(beta,\ b)}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{comment}{//*\ Quaternion::getRotationQuaternion(alpha,\ a)\ *}}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{//\ q.getComplexConjugate()).v.length()));}}
\DoxyCodeLine{00167\ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00173\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \mbox{\hyperlink{namespacecrl_1_1loco_a870108d99952a0c8d8c08b1e54f2938e}{updateRotationGivenAngularVelocity}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&q,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ \&angularVelocity,\ \textcolor{keywordtype}{double}\ dt)\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ q\_p\ =\ rot(w,\ dt)\ *\ q}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordtype}{double}\ angularVelocityMagnitude\ =\ angularVelocity.norm();}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{comment}{//\ avoid\ divide\ by\ close\ to\ zero...}}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{if}\ (angularVelocityMagnitude\ >\ 1e-\/10)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ compute\ the\ rotation\ that\ would\ have\ happened\ during\ dt,\ and\ add\ it}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (pre)\ to\ the\ current\ orientation}}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ netRotationAngle\ =\ angularVelocityMagnitude\ *\ dt;}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ rotationAxis\ =\ angularVelocity.normalized();}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacecrl_a97d2ee8bd0dcfe6cf8d3cbfb9e40ad92}{getRotationQuaternion}}(netRotationAngle,\ rotationAxis)\ *\ q;}
\DoxyCodeLine{00183\ \ \ \ \ \}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{return}\ q;}
\DoxyCodeLine{00185\ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00191\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ \mbox{\hyperlink{namespacecrl_1_1loco_ad4b1769819908066d5c65c8bdc75d8c4}{estimateAngularVelocity}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&qStart,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ \&qEnd,\ \textcolor{keywordtype}{double}\ dt)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{comment}{//\ qEnd\ =\ rot(w\_p,\ dt)\ *\ qStart}}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ qRot\ =\ qEnd\ *\ qStart.inverse();}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ rotAxis\ =\ \mbox{\hyperlink{namespacecrl_a77bf57b80c0739c3c3dcbe55c0e92f09}{Vector3d}}(qRot.vec());}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordflow}{if}\ (rotAxis.norm()\ <\ 1e-\/10)}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}(0,\ 0,\ 0);}
\DoxyCodeLine{00198\ \ \ \ \ rotAxis.normalize();}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordtype}{double}\ rotAngle\ =\ \mbox{\hyperlink{namespacecrl_a5db0b1362dd412558a35ba80d255997e}{getRotationAngle}}(qRot,\ rotAxis);}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{comment}{//\ this\ rotation\ angle\ is\ the\ result\ of\ applying\ the\ angular\ velocity\ for}}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{comment}{//\ some\ time\ dt...}}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordflow}{return}\ rotAxis\ *\ rotAngle\ /\ dt;}
\DoxyCodeLine{00204\ \}}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00211\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacecrl_1_1loco_ab9202e570d41e2629b3568442b90298f}{testQuaternionDecomposition}}()\ \{}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 100;\ i++)\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ v\ =\ \mbox{\hyperlink{namespacecrl_acdc58a9daebadc96d93a7c02113b1bf7}{getRandomUnitVector}}();}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcrl_1_1_v3_d}{V3D}}\ a,\ b;}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacecrl_ad1ffb7a0e6fb2c2103cfd31992518f84}{getVectorsOrthogonalTo}}(v,\ a,\ b);}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ aVal\ =\ \mbox{\hyperlink{namespacecrl_a9fb90d53d86d80f9a275890ce6bc423a}{getRandomNumberInRange}}(-\/\mbox{\hyperlink{math_defs_8h_a598a3330b3c21701223ee0ca14316eca}{PI}}\ *\ 0.98,\ \mbox{\hyperlink{math_defs_8h_a598a3330b3c21701223ee0ca14316eca}{PI}}\ *\ 0.98);}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ bVal\ =\ \mbox{\hyperlink{namespacecrl_a9fb90d53d86d80f9a275890ce6bc423a}{getRandomNumberInRange}}(-\/\mbox{\hyperlink{math_defs_8h_a598a3330b3c21701223ee0ca14316eca}{PI}}\ *\ 0.98,\ \mbox{\hyperlink{math_defs_8h_a598a3330b3c21701223ee0ca14316eca}{PI}}\ *\ 0.98);}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ aValTest\ =\ 0,\ bValTest\ =\ 0;}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ qTest\ =\ \mbox{\hyperlink{namespacecrl_a97d2ee8bd0dcfe6cf8d3cbfb9e40ad92}{getRotationQuaternion}}(bVal,\ b)\ *\ \mbox{\hyperlink{namespacecrl_a97d2ee8bd0dcfe6cf8d3cbfb9e40ad92}{getRotationQuaternion}}(aVal,\ a);}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacecrl_1_1loco_aa72b2b70e13f2b1a9c152033e638beb6}{computeEulerAnglesFromQuaternion}}(qTest,\ a,\ b,\ aValTest,\ bValTest);}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacecrl_a6e0054d6b8b0879cd0d7f2c0c63122ce}{Quaternion}}\ qErr\ =\ \mbox{\hyperlink{namespacecrl_a97d2ee8bd0dcfe6cf8d3cbfb9e40ad92}{getRotationQuaternion}}(bValTest,\ b)\ *\ \mbox{\hyperlink{namespacecrl_a97d2ee8bd0dcfe6cf8d3cbfb9e40ad92}{getRotationQuaternion}}(aValTest,\ a)\ *\ qTest.inverse();}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ assert(qErr.vec().norm()\ <\ 0.000001);}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{math_defs_8h_a398c705a9725b7e6617eb2e03924ae88}{IS\_EQUAL}}(aVal,\ aValTest)\ \&\&\ \mbox{\hyperlink{math_defs_8h_a398c705a9725b7e6617eb2e03924ae88}{IS\_EQUAL}}(bVal,\ bValTest));}
\DoxyCodeLine{00224\ \ \ \ \ \}}
\DoxyCodeLine{00225\ \}}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \}\ \ \textcolor{comment}{//\ namespace\ crl::loco}}

\end{DoxyCode}
